/**
 * sutility v0.0.1 - 2015-06-18
 * Functional Library
 *
 * Copyright (c) 2015 soushinas noorghorbani <snoorghorbani@gmail.com>
 * Licensed MIT
 */
(function(undefined){"use strict";var debugMode=!0,UTILITY=function(){var U=function(){var that=this;this.merge=function(toObj,fromObj){this.is.object(fromObj)?this.each(fromObj,function(value,key){toObj[key]=fromObj[key]}):this.is.array(fromObj)&&this.each(fromObj,function(value){toObj.push(value)})},this.update=function(toObj,fromObj,copyPrototype){return this.is.object(fromObj)&&this.each(toObj,function(value,key){fromObj[key]!==undefined&&(toObj[key]=fromObj[key])}),toObj},this.extend=function(toObj,fromObj,proroAssign){return this.is.not.defined(toObj)&&this.fail("destination object cant be null"),this.is.array(toObj)?this.safeAssignArray(toObj,fromObj):this.is.object(toObj)?(this.safeClear(toObj),this.each(fromObj,function(value,key){toObj[key]=value},this,proroAssign)):toObj=fromObj,toObj},this.assignIfDefined=function(to,fnOrObj){return fnOrObj!==undefined?that.safeAssign(to,fnOrObj):to},this.assignIfNotDefined=function(varible,fnOrObj){return varible===undefined?fnOrObj:varible},this.upsert=function(container,item,indicator,updateAll){debugMode&&this.not(this.is.array,container);var newItem=!0;this.each(container,function(v,i){indicator(v)&&(newItem=!1,that.safeAssign(container[i],item))});newItem&&container.push(item)},this.cloneObj=function(obj,prototype){prototype=this.assignIfNotDefined(prototype,!0);var temp=this.object();for(var key in obj)(prototype||obj.hasOwnProperty(key))&&(temp[key]=obj[key]);return temp},this.cloneArray=function(ar){return ar.concat()},this.clone=function(arOrObj){if(arOrObj.concat)return arOrObj.concat();var temp={};for(var key in arOrObj)temp[key]=arOrObj[key];return temp},this.each=function(obj,iterator,context,onProto){if(onProto=this.assignIfNotDefined(onProto,!1),!obj)return!1;this.is.nodeList(obj)&&this.each(this.argToArray(obj),iterator,context);var key;if(this.is.array(obj)||this.is["function"](obj))for(key in obj)(obj.hasOwnProperty(key)||onProto)&&iterator.call(context,obj[key],key);if(this.is.object(obj))for(key in obj)(obj.hasOwnProperty(key)||onProto)&&iterator.call(context,obj[key],key)},this.map=function(obj,iterator,context){var results=[];return this.each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))}),results};this.filter=function(obj,condFn){var res=[];return this.each(obj,function(item){condFn(item)&&res.push&&res.push(item)}),res};this.fine=function(ar,fn){var status=!0;return _.each(ar,function(i){fn(i)||(status=!1)}),status},this.indexOf=function(obj,idxOrIterator,context){var res;return this.is["function"](idxOrIterator)?this.each(obj,function(item,idx){idxOrIterator.call(context,item)&&(res=idx)}):res=obj.indexOf(idxOrIterator),res},this.repeat=function(len,fn,context){for(var res=[],i=0;len>i;i++)res.push(fn.call(context));return res},this.extendFunc=function(fn,callBack){var data=arguments[2];return function(){fn.call(this),callBack.call(this,data)}},this.runOnce=function(){},this.arc=function(ctx,x,y,r,f,t,b){ctx.beginPath(),ctx.arc(x,y,r,f,t,b),ctx.closePath(),ctx.fill(),ctx.stroke()},this.rect=function(ctx,x,y,w,h,fill,stroke){ctx.beginPath(),ctx.rect(x,y,w,h),ctx.closePath(),fill!==!1&&ctx.fill(),stroke!==!1&&ctx.stroke()},this.text=function(ctx,text,x,y){ctx.beginPath(),ctx.fillText(text,x,y),ctx.fill(),ctx.closePath()},this.line=function(ctx,startPoint,endPoint){ctx.beginPath(),ctx.moveTo(startPoint.x,startPoint.y),ctx.lineTo(endPoint.x,endPoint.y),ctx.closePath(),ctx.stroke()},this.argToArray=function(arg){return Array.prototype.slice.call(arg)},this.concat=function(fa,sa){return this.not(this.is.array,fa)&&this.fail("is Not Array"),this.not(this.is.array,sa)&&this.fail("is Not Array"),fa.concat(sa)},this.complement=function(fn){return function(){return!fn.apply(null,this.argToArray(arguments))}},this.not=function(fn){var args=this.argToArray(arguments);return args.shift(),!fn.apply(this,args)},this.reverseArray=function(ar){this.not(this.is.array,ar)&&this.fail("is Not Array");for(var res=[],i=ar.length-1,j=0;i>=0;i--,j++)res[j]=ar[i];return res},this.fail=function(text){throw new Error(text)},this.warn=function(text){return undefined},this.note=function(text){},this.remove=function(ar,idx){return this.not(this.is.array,ar)&&this.fail("is Not Array"),ar.length<idx&&this.fail("greeter that array length"),ar=ar.splice(idx,1)},this.compileString=function(str,varDef,fn){var regex=/\{\{/,result=[],varStartIdx=str.search(regex);if(varStartIdx>-1){result[result.length]=str.substring(0,varStartIdx),str=str.substring(varStartIdx);var varEndIdx=str.search(/\}\}/),varKey=str.substring(2,varEndIdx),varValue=varDef[varKey.trim()];this.is.object(varValue)&&(varValue=fn.call(null,varValue)),result[result.length]=varValue,str=str.substring(varEndIdx+2),result=result.concat(this.compileString(str,varDef,fn))}else result[result.length]=str;return result.join("")},this.haveKey=function(obj,path){this.not(this.is.object,obj)&&this.warn("is Not Object");for(var route,tempObj=obj,routes=path.split("."),i=0;route=routes[i];i++){if(!tempObj[route]&&0!==tempObj[route])return this.warn(["dont have ",route,"property"].join(" ")),!1;this.is.not.array(tempObj[route])&&(tempObj=tempObj[route])}return!0},this.valueOf=function(objOrArr,pathOrIndex){var tempobjOrArr;if(this.is.array(objOrArr))return objOrArr[pathOrIndex];tempobjOrArr=objOrArr;for(var route,routes=pathOrIndex.split("."),i=0;route=routes[i];i++){if(!tempobjOrArr[route])return this.warn(["dont have ",route,"property"].join(" ")),null;if(this.is.array(tempobjOrArr[route])){for(var item,res={},partialRoutes=routes.splice(i+1),j=0;item=tempobjOrArr[route][j];j++)res[j]=this.getValue2(item,partialRoutes.join("."));return res}tempobjOrArr=tempobjOrArr[route]}return tempobjOrArr},this.getValue=function(obj,path){if(!obj)return undefined;if(!obj)return this.warn("UTILITY getValue function first parameter not defined");if(null!==obj[path])return obj[path];path=path.split(".");for(var i=0,res=obj[path[i++]];i<path.length;)res=res[path[i++]];return i==path.length?res:null},this.toString=function(obj){this.not(this.is.object,obj)&&this.fail("is not object");var str="";for(var key in obj)this.is.object(obj[key])?str+=this.toString(obj[key]):(str+=" , ",str+=obj[key]);return str},this["interface"]=function(obj,decl){},this.multiply=function(fn,ln){return fn*ln},this.leftCurry=function(fn,context){return context=context||that,function(){var leftArgs=that.argToArray(arguments);return function(){var args=that.concat(leftArgs,that.argToArray(arguments));return fn.apply(context,args)}}},this.rightCurry=function(fn){return function(){var rightArgs=that.argToArray(arguments);return function(){var args=that.concat(that.argToArray(arguments),rightArgs);return fn.apply(that,args)}}},this.random=function(min,max){return(max-min)*Math.random()+min},this.runInFunc=function(fn){return this.not(this.is["function"],fn)&&this.warn(fn+"is not function"),function(){fn()}},this.randJson=function(len,props){var res=[];return this.repeat(len,function(){var item={};this.each(props,function(prop){"string"==prop.type?item[prop.name]=this.randString(6):"number"==prop.type&&(item[prop.name]=this.random(0,9))},this),res.push(item)},this),res},this.randString=function(len){var res="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";return this.repeat(len,function(){res+=possible[this.random(0,possible.length).toFixed()]},this),res},this.randColor=function(){var r=this.random(1,256).toFixed(),g=this.random(1,256).toFixed(),b=this.random(1,256).toFixed();return"rgb("+r+","+g+","+b+")"},this.idMode=function(ar,iden){for(var item,res={},i=0;item=ar[i];i++)item[iden]&&(res[item[iden]]=item,res[item[iden]].active="");return res},this.getXHR=function(){var instance=new XMLHttpRequest;return instance},this.getJSON=function(options,callback){var xhttp=this.getXHR();options.url=options.url||location.href,options.data=options.data||null,callback=callback||function(){},options.type=options.type||"json";var url=options.url;if("jsonp"==options.type){window.jsonCallback=callback;var $url=url.replace("callback=?","callback=jsonCallback"),script=document.createElement("script");script.src=$url,document.body.appendChild(script)}xhttp.open("GET",options.url,!0),xhttp.send(options.data),xhttp.onreadystatechange=function(){200==xhttp.status&&4==xhttp.readyState&&callback(xhttp.responseText)}},this.exec=function(){var args=this.argToArray(arguments),fn=args.shift(),context=args.shift(),arg=args.shift();return this.not(this.is["function"],fn)&&this.warn(fn+"is not function"),fn.apply(context||null,arg)},this.objectKeys=function(){var args=this.argToArray(arguments),obj=args[0],res=[];return this.each(obj,function(value,key){res.push(key)}),res},this.valueOfAll=function(arrayOfObject,key){var res=[];return this.each(arrayOfObject,function(item){item[key]&&res.push(item[key])}),res},this.objToTwoDimArray=function(){var args=this.argToArray(arguments),obj=args[0],res=[];return this.each(obj,function(itemValue,itemKey){var temp=[];temp[0]=[itemValue],temp[1]=[itemKey],res.push(temp)}),res},this.arrToObj=function(){var args=this.argToArray(arguments),arr=args.shift(),key=args.shift(),removeKey=args.shift(),res={};return this.each(arr,function(item){var temp=item[key];removeKey&&delete item[key],res[temp]=item}),res},this.contain=function(obj,value){for(var i=0;i<obj.length;i++)if(obj[i]==value)return!0;return!1},this.subSet=function(fo,so){},this.remove=function(obj,idx,len){return this.is.array(obj)&&obj.length>idx?obj.splice(idx,len?len:1):null},this.categorize=function(obj,key){var res={};return this.each(obj,function(item){var temp=item[key].toString();res[temp]=res[temp]||[],res[temp].push(item)}),res},this.sortBy=function(obj,typeOrOperator,path){var that=this;return this.is["function"](typeOrOperator)?obj.sort(typeOrOperator):"string"==typeOrOperator?obj.sort(function(a,b){var textA=that.getValue(a,path).toUpperCase(),textB=that.getValue(b,path).toUpperCase();return textB>textA?-1:textA>textB?1:0}):"number"==typeOrOperator?obj.sort(function(a,b){return that.getValue(a,path)>that.getValue(b,path)?1:-1}):void 0},this.sortBy2=function(obj,typeOrOperator,path){},this.groupBy=function(obj,prop,fn){fn=fn||this["return"];var res={};return this.each(obj,function(item){var flag=item.data[prop];res[flag]=res[flag]||[],res[flag].push(fn(item))}),res},this.groupIf=function(obj,cond,fn){fn=fn||this["return"];var res={};return this.each(obj,function(item){var flag=cond(item);res[flag]=res[flag]||[],res[flag].push(fn(item))}),res},this.groupByFlatMode=function(){var that=this,args=this.argToArray(arguments),obj=args.shift(),props=args.shift(),res={};return this.each(obj,function(item){var flag="";that.each(props,function(prop){flag+="_"+item[prop]}),res[flag]=res[flag]||[],res[flag].push(item)}),res},this.groupByTreeMode=function(){var that=this,args=this.argToArray(arguments),obj=args.shift(),props=args.shift(),prop=props.shift(),fn=args.shift(),grouped=that.groupBy(obj,prop,fn);return this.each(grouped,function(group,i){props.length>0&&(grouped[i]=that.groupByTreeMode.call(that,group,_.cloneArray(props),fn))}),obj=grouped},this.indexBy=function(){},this.countBy=function(){},this.flatTreeBy=function(data,childAttr,parentAttr,res,parentIdn,defaultRootValue,depth){res=res||[],depth=depth||0,_.each(_.cloneObj(data),function(item){item.parentIdn=parentIdn||defaultRootValue||"root",item.depth=depth,res.push(item),item[childAttr]&&item[childAttr].length>0&&that.flatTreeBy(item[childAttr],childAttr,parentAttr,res,item[parentAttr],defaultRootValue,depth+1),delete item[childAttr]})},this.verify=function(obj,comparator){this.not(this.is.object,obj)&&this.fail("is Not Object"),this.not(this.is.object,comparator)&&this.fail("is Not Object"),this.haveKey(comparator,"key")&&this.haveKey(comparator,"condition")&&this.haveKey(comparator,"value")||this.fail("dont have correct comparator attrs");var value=obj[comparator.key];return value!==undefined&&_.compare(value,comparator.condition,comparator.value)},this.replaceInArray=function(array,from,replaceBy){Array.prototype.splice.apply(array,[from,replaceBy.length+from].concat(replaceBy))},this.safeAssignArray=function(to,from){this.replaceInArray(to,0,from)},this.safeClear=function(objOrArr){if(this.is.array(objOrArr))Array.prototype.splice.apply(objOrArr,[0,objOrArr.length].concat([]));else for(var i in objOrArr)objOrArr.hasOwnProperty(i)&&delete objOrArr[i]},this.getCumulativeOffset=function(obj){var left,top;if(left=top=0,obj.offsetParent)do left+=obj.offsetLeft,top+=obj.offsetTop;while(obj=obj.offsetParent);return{x:left,y:top}},this.recursive=function(){},this.fn=function(){return function(){}},this.constValue=function(d){var v=d;return function(){return v}},this.i=function(i){return i},this.propByPrefix=function(obj,prefix,removePrefixFromKey){removePrefixFromKey=_.assignIfNotDefined(removePrefixFromKey,!1);var properties={};for(var key in obj)if(0===key.search(prefix)){var propName=removePrefixFromKey?this.camelCase(key.substr(prefix.length)):key;properties[propName]=obj[key]}return properties},this.camelCase=function(str){return str.toLowerCase().replace(/-(.)/g,function(match,group1){return group1.toUpperCase()})},this.pascalCase=function(str){return str[0].toUpperCase()+str.substr(1,str.lenght)},this.regularCase=function(str){return str.replace(/([A-Z])/g," $1").replace(/^./,function(str){return str.toUpperCase()})},this.extractWrapedBy=function(str,wrapper){var pattern=null;if("{}"==wrapper)pattern=/\{(.*?)\}/g;else if("()"==wrapper)pattern=/\((.*?)\)/g;else{if("[]"!=wrapper)return;pattern=/\[(.*?)\]/g}for(var regex=new RegExp(pattern),matched=str.match(regex),i=0;matched&&i<matched.length;i++)matched[i]=matched[i].substring(1,matched[i].length-1);return matched},this.spliteAndTrim=function(str){return str.split(/[\s,]+/)},this.chain=function(fn,callback,context){return function(){var args=that.argToArray(arguments),fnResault=that.exec(fn,context||null,args),promise=fnResault?fnResault.promise||fnResault.$promise:null;return promise?void promise.then(function(){return that.exec(callback,context||null,[fnResault])}):fnResault&&fnResault.then?(fnResault.then(function(){var args=that.argToArray(arguments);that.exec(callback,context||null,args)}),fnResault):that.exec(callback,context||null,[fnResault])}},this.removeEventArg=function(a){this.each(a,function(i,j){i.currentScope&&i.targetScope&&this.remove(a,j)},this)},this.dataset=function(_,undefined){var dataset=function(){};return dataset.add=function(){},dataset.get=function(el,name){return el.dataset[name]},dataset}(this),this.attr=function(_,undefined){var attr=function(){};return attr}(this),this.addClass=function(selectorOrDom,className){this.warn("change refrence");for(var nodes=this.select(selectorOrDom),i=0;i<nodes.length;i++)nodes[i].classList?DOMTokenList.prototype.add.apply(nodes[i].classList,_.spliteAndTrim(className)):-1===nodes[i].className.indexOf(className)&&(nodes[i].className=nodes[i].className+" "+className)},this.removeClass=function(selectorOrDom,className){this.warn("change refrence");for(var nodes=this.select(selectorOrDom),i=0;i<nodes.length;i++)if(nodes[i].classList)DOMTokenList.prototype.remove.apply(nodes[i].classList,_.spliteAndTrim(className));else{var reg=new RegExp(className,"g");nodes[i].className=nodes[i].className.replace(reg,"").trim()}},this.changeClass=function(selectorOrDom,className,replaceWith){this.warn("change refrence");var nodes=this.select(selectorOrDom);_.removeClass(nodes,className),_.addClass(nodes,replaceWith)},this.availableDim=function(){var inner=document.createElement("div");inner.style.position="fixed",inner.style.top="0px",inner.style.right="0px",inner.style.bottom="0px",inner.style.left="0px",document.body.appendChild(inner);var height=inner.offsetHeight,width=inner.offsetWidth;return inner.parentNode.removeChild(inner),{height:height,width:width}},this.cancelBubble=function(e){var evt=e?e:window.event;evt.stopPropagation&&evt.stopPropagation(),null!==evt.cancelBubble&&(evt.cancelBubble=!0)},this.config=function(prop,obj){for(var k in prop)this[k]=obj&&obj[k]||prop[k]},this.ready=function(){var repos=[];return function(fn){return repos.push(fn),"interactive"==document.readyState?void fn():void document.addEventListener("DOMContentLoaded",fn,!0)}}(),this.loadJS=function(_){var loadedFiles={};return function(path,callback){if(loadedFiles[path])loadedFiles[path].state?setTimeout(function(){callback(path)},1):loadedFiles[path].callbacks.push(callback);else{loadedFiles[path]={state:!1,callbacks:[]},loadedFiles[path].callbacks.push(callback);var script=document.createElement("script");script.setAttribute("type","text/javascript"),script.onload=function(a,b,c){loadedFiles[path].state=!0;for(var fn,i=0;fn=loadedFiles[path].callbacks[i];i++)fn(path)},script.setAttribute("src","/"+path),document.getElementsByTagName("head")[0].appendChild(script)}}}(this),this.loadCSS=function(_){var loadedFiles={};return function(path,callback){if(!loadedFiles[path]){var css=document.createElement("link");css.setAttribute("rel","stylesheet"),css.setAttribute("href","/"+path),document.getElementsByTagName("head")[0].appendChild(css)}}}(this),this.data=function(_){}(this),this.scope=function(){var Scope=function(){this.fn={},this.data={},this.config={},this.option={},this.event={},this.module={},this["const"]={}};return new Scope},this.eventBus={topics:{},sub:function(topic,listener){this.topics[topic]||(this.topics[topic]=[]),this.topics[topic].push(listener)},unsub:function(){},pub:function(topic,data){!this.topics[topic]||this.topics[topic].length<1||this.topics[topic].forEach(function(listener){listener(data||{})})}},this._Observable={observers:[],lastId:-1,addObserver:function(observer){return this.observers.push({callback:observer,id:++this.lastId}),this.lastId},removeObserver:function(id){for(var i=this.observers.length-1;i>=0;i--)if(this.observers[i],this.observers[i].id==id)return this.observers.splice(i,1),!0;return!1},notifyObservers:function(message){for(var i=this.observers.length-1;i>=0;i--)this.observers[i].callback(message)}},this.Observable=function(that,undefined){function Observable(obj){this.subsciber=[]}return Observable.prototype.observe=function(obj){this.subsciber.push(obj)},Observable.prototype.unobserve=function(obj){for(var i=0,len=this.subsciber.length;len>i;i++)if(this.subsciber[i]===obj)return this.subsciber.splice(i,1),!0;return!1},Observable.prototype.notify=function(){for(var args=Array.prototype.slice.call(arguments,0),i=0,len=this.subsciber.length;len>i;i++)this.subsciber[i].update.apply(null,args)},Observable.set=function(val){},Observable}(this),this.decorator=function(){},this.impelemetIn=function(child){},this.freezable=function(_,undefined){var o={};return o.freeze=function(key){},o.unfreeze=function(key){},function(constructor_obj){}}(this),this.get=function(){var get=function(){};return get.constructor=function(obj){return obj.constructor},get}(),this.prototype=function(_,undefined){var prototype=function(){};return prototype.extend=function(constructor_obj,prototypeObj){_["if"].is.not["function"](constructor_obj,function(){return _.get.constructor(constructor_obj)});for(var i in prototypeObj)prototypeObj.hasOwnProperty(i)&&(constructor_obj.prototype[i]=prototypeObj[i])},prototype}(this),this.on=function(dom,state,fn){},this.event=function(domOrSelector,state,fn){var nodes=this.select(domOrSelector);this.each(nodes,function(node){node.addEventListener(state,fn)})},this.fixEvent=function(e){window.event=window.event||e},this.bind=function(el,obj,decorator){decorator=decorator||this.i},this.activated=function(parentOrSelector,selector,classname,callback){classname=classname||"active";var parents=_.select(parentOrSelector);_.each(parents,function(parent){var nodes=_.select(selector,parent);_.each(nodes,function(node){_.event(node,"click",function(){_.removeClass(nodes,classname),_.addClass(node,classname),callback&&callback(this)})})})},this.regex=function(_){var type={number:/\d+/g},fn=_.fn;return fn.match=function(str){return str.match(type.number)},fn.matchFirst=function(str){return str.match(type.number)[0]},fn.type=type,fn}(this),this.shift=function(array,callback){var item,n=0;if("number"==typeof callback)n=callback;else if(that.is["function"](callback))for(var index=0;callback(array[index++]);)n++;else n++;return item=array.slice(0,n),that.is.array(item)&&1===item.length?item[0]:item};var scrollTopSubs={},scrollDownSubs={};this.onScrollDown=function(Y,fn){scrollDownSubs[Y]=scrollDownSubs[Y]||[],scrollDownSubs[Y].push(fn)},this.onScrollTop=function(Y,fn){scrollTopSubs[Y]=scrollTopSubs[Y]||[],scrollTopSubs[Y].push(fn)},this.onscroll=function(onscroll){var methods=[];return window.onscroll=function(){that.each(methods,function(method){method()})},function(fn){methods.push(fn)}}(window.onscroll),this.preventEvent=function(e){var eve=e||window.event;eve.preventDefault(),eve.stopPropagation()},this.object=function(init){var Fn=_.fn();return _.extend(new Fn,init)},this.strStartsWith=function(str,prefix){return 0===str.indexOf(prefix)},this.onscroll(function(){var cs=window.scrollY;that.each(scrollTopSubs,function(state,key){cs>key&&that.each(scrollTopSubs[key],function(handler){handler()})}),that.each(scrollDownSubs,function(state,key){key>cs&&that.each(scrollDownSubs[key],function(handler){handler()})})})};return{installHelperOn:function(_this){U.call(_this)},get:function(){return new U}}}();"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports?exports=module.exports=UTILITY.get():this._=UTILITY.get()}).call(this);